<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³æ•ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #ffbf36;
        }
        button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            background: #ff0043;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #cc0036;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 5px;
        }
        .success { color: #14fc56; }
        .error { color: #ff0043; }
        .info { color: #1e7fff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ† çƒŸèŠ±æ¨¡æ‹Ÿå™¨ - éŸ³æ•ˆæµ‹è¯•</h1>
        
        <div class="status">
            <h2>æµ‹è¯•è¯´æ˜ï¼š</h2>
            <ol>
                <li>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å„ç§éŸ³æ•ˆ</li>
                <li>å¦‚æœå¬ä¸åˆ°å£°éŸ³ï¼Œè¯·æ£€æŸ¥ï¼š
                    <ul>
                        <li>æµè§ˆå™¨éŸ³é‡æ˜¯å¦å¼€å¯</li>
                        <li>ç³»ç»ŸéŸ³é‡æ˜¯å¦å¼€å¯</li>
                        <li>æµè§ˆå™¨æ˜¯å¦å…è®¸è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div id="status" class="status"></div>

        <h2>éŸ³æ•ˆæµ‹è¯•æŒ‰é’®ï¼š</h2>
        <button onclick="testSound('lift')">ğŸš€ å‘å°„éŸ³æ•ˆ (lift)</button>
        <button onclick="testSound('burst')">ğŸ’¥ çˆ†ç‚¸éŸ³æ•ˆ (burst)</button>
        <button onclick="testSound('crackle')">âœ¨ çˆ†è£‚éŸ³æ•ˆ (crackle)</button>
        <button onclick="testSound('crackleSmall')">âš¡ å°çˆ†è£‚éŸ³æ•ˆ (crackleSmall)</button>
        <button onclick="testSound('burstSmall')">ğŸ’« å°çˆ†ç‚¸éŸ³æ•ˆ (burstSmall)</button>
        <br>
        <button onclick="testBgMusic()">ğŸµ èƒŒæ™¯éŸ³ä¹æµ‹è¯•</button>
        <button onclick="testFireworkSequence()">ğŸ† å®Œæ•´çƒŸèŠ±éŸ³æ•ˆåºåˆ—</button>
    </div>

    <script>
        const soundManager = {
            baseURL: "./audio/",
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            sources: {
                lift: {
                    volume: 1,
                    fileNames: ["lift1.mp3", "lift2.mp3", "lift3.mp3"]
                },
                burst: {
                    volume: 1,
                    fileNames: ["burst1.mp3", "burst2.mp3"]
                },
                burstSmall: {
                    volume: 0.25,
                    fileNames: ["burst-sm-1.mp3", "burst-sm-2.mp3"]
                },
                crackle: {
                    volume: 0.2,
                    fileNames: ["crackle1.mp3"]
                },
                crackleSmall: {
                    volume: 0.3,
                    fileNames: ["crackle-sm-1.mp3"]
                }
            },
            buffers: {},

            async preload() {
                const status = document.getElementById('status');
                status.innerHTML = '<p class="info">â³ æ­£åœ¨åŠ è½½éŸ³é¢‘æ–‡ä»¶...</p>';
                
                try {
                    for (const [type, source] of Object.entries(this.sources)) {
                        this.buffers[type] = [];
                        for (const fileName of source.fileNames) {
                            const response = await fetch(this.baseURL + fileName);
                            const arrayBuffer = await response.arrayBuffer();
                            const audioBuffer = await this.ctx.decodeAudioData(arrayBuffer);
                            this.buffers[type].push(audioBuffer);
                        }
                    }
                    status.innerHTML = '<p class="success">âœ… éŸ³é¢‘æ–‡ä»¶åŠ è½½æˆåŠŸï¼å¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚</p>';
                } catch (error) {
                    status.innerHTML = `<p class="error">âŒ éŸ³é¢‘åŠ è½½å¤±è´¥: ${error.message}</p>`;
                }
            },

            playSound(type, volume = 1) {
                if (!this.buffers[type] || this.buffers[type].length === 0) {
                    console.error(`éŸ³æ•ˆç±»å‹ "${type}" æœªåŠ è½½`);
                    return;
                }

                const source = this.sources[type];
                const buffer = this.buffers[type][Math.floor(Math.random() * this.buffers[type].length)];
                
                const gainNode = this.ctx.createGain();
                gainNode.gain.value = source.volume * volume;

                const bufferSource = this.ctx.createBufferSource();
                bufferSource.buffer = buffer;
                bufferSource.connect(gainNode);
                gainNode.connect(this.ctx.destination);
                bufferSource.start(0);

                console.log(`æ’­æ”¾éŸ³æ•ˆ: ${type}, éŸ³é‡: ${gainNode.gain.value}`);
            }
        };

        function testSound(type) {
            const status = document.getElementById('status');
            status.innerHTML = `<p class="info">ğŸ”Š æ­£åœ¨æ’­æ”¾: ${type}</p>`;
            soundManager.playSound(type);
        }

        function testBgMusic() {
            const status = document.getElementById('status');
            const bgMusic = new Audio('./audio/Happy-New-Year-A-Teens.mp3');
            bgMusic.volume = 0.3;
            bgMusic.play().then(() => {
                status.innerHTML = '<p class="success">ğŸµ èƒŒæ™¯éŸ³ä¹æ’­æ”¾ä¸­...</p>';
            }).catch(error => {
                status.innerHTML = `<p class="error">âŒ èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥: ${error.message}</p>`;
            });
        }

        function testFireworkSequence() {
            const status = document.getElementById('status');
            status.innerHTML = '<p class="info">ğŸ† æ¨¡æ‹Ÿå®Œæ•´çƒŸèŠ±éŸ³æ•ˆåºåˆ—...</p>';
            
            // å‘å°„
            soundManager.playSound('lift');
            
            // 1ç§’åçˆ†ç‚¸
            setTimeout(() => {
                soundManager.playSound('burst');
                
                // æ·»åŠ çˆ†è£‚éŸ³æ•ˆ
                setTimeout(() => soundManager.playSound('crackle', 0.8), 50);
                setTimeout(() => soundManager.playSound('crackleSmall', 0.6), 150);
                setTimeout(() => soundManager.playSound('crackleSmall', 0.5), 250);
                setTimeout(() => soundManager.playSound('burstSmall', 0.7), 100);
                
                status.innerHTML = '<p class="success">âœ… å®Œæ•´çƒŸèŠ±éŸ³æ•ˆåºåˆ—æ’­æ”¾å®Œæˆï¼</p>';
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶é¢„åŠ è½½éŸ³é¢‘
        window.addEventListener('DOMContentLoaded', () => {
            soundManager.preload();
        });
    </script>
</body>
</html>
